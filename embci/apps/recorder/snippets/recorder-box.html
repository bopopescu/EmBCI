<div id="recorder">
    <style>
        div#recorder {
            position: fixed;
            right: 3%;
            bottom: 10%;
            z-index: 2;
            display: none;
        }
        div#recorder > button#record-btn {
            position: absolute;
            right: 0;
            bottom: 0;
            height: 44px;
            width: 44px;
            padding: 0;
            border: 2px solid #DDDDDD;
            border-radius: 15px;
            outline: none;
            background: none;
        }
        div#recorder > button#record-btn span {
            position: absolute;
            top: 0;
            left: 0;
            width: 28px;
            height: 28px;
            margin: 6px;
            border-width: 0;
            border-radius: 50%;
            transition: all 500ms;
            background-color: red;
        }
        div#recorder > button#record-btn[aria-expanded="true"] span {
            height: 20px;
            width: 20px;
            margin: 10px;
            border-radius: 25%;
        }
        /*
        div#recorder > form#record-form {
            display: inline-block;
            position: absolute;
            right: 0px;
            bottom: 45px;
            width: auto;
            height: 35px;
        }
        */
        div#recorder > form#record-form {
            position: relative;
            right: 0px;
            bottom: 45px;
            height: 35px;
            overflow: hidden;
        }
        div#recorder > form#record-form span {
            cursor: pointer;
            line-height: 35px;
            font-size: 22px;
            color: grey;
            text-align: center;
        }
        div#recorder > form#record-form span#record-icon-user {
            width: 44px;
        }
        div#recorder > form#record-form input#record-user {
            float: right;
            outline: none;
            padding-left: 10px;
            padding-right: 30px;
            border-width: 0 0 2px 0;
            border-color: #33DDFFAA;
            background: transparent;
            height: 100%;
            width: 150px;
            transition: all 1200ms;
        }
        div#recorder > form#record-form span#record-icon-confirm {
            width: 30px;
            position: absolute;
            top: 0;
            right: 0;
            z-index: 3;
            display: none;
        }
        div#recorder > form#record-form.fold input#record-user {
            width: 0;
            padding: 0;
        }
        div#recorder.recording #record-icon-user {color: green;}
    </style>
    <form class="collapse fold" id="record-form">
        <span class="fas fa-user" id="record-icon-user"></span>
        <input type="text" name="username" placeholder="Username" id="record-user">
        <span class="fas fa-check-circle" id="record-icon-confirm"></span>
    </form>
    <button id="record-btn" data-toggle="collapse"
        data-target="div#recorder form#record-form"
        aria-expanded="false">
        <span></span>
    </button>
    <script type="text/javascript">
        $(function(){
            var recorder = $('div#recorder');
            recorder.css('display', recorder.data('display'));
            recorder
                .on('hide', function() {
                    var btn = recorder.find('button#record-btn');
                    if (btn.attr('aria-expanded') == 'true') {
                        btn.trigger('click');
                    }
                    recorder.hide();
                    recorder.trigger('update', {username: 'none'});
                })
                .on('show', ()=>recorder.show())
                .on('start').on('stop').on('pause').on('resume').on('update');
            recorder.find('input#record-user')
                .on('focus', ()=>recorder.find('#record-icon-confirm').show(300))
                .on('blur', ()=>recorder.find('#record-icon-confirm').hide(300));
            recorder.find('button#record-btn').on('click', function() {
                if ($(this).attr('aria-expanded') == 'true') {
                    recorder.trigger('pause');
                    recorder.children('form#record-form').addClass('fold');
                } else {
                    recorder.trigger('resume');
                }
            });
            recorder.find('#record-icon-user').on('click', function() {
                /*
                 * If icon is clicked while recording, update user status.
                 * If username input form is displayed (i.e. not folded) while
                 * not recording, click #record-icon-confirm (update username).
                 */
                if (recorder.hasClass('recording')) {
                    recorder.trigger('update');
                } else if (!recorder.children('#record-form').hasClass('fold')) {
                    recorder.find('#record-icon-confirm').click();
                }
                recorder.children('#record-form').toggleClass('fold');
            });
            recorder.find('#record-icon-confirm').on('click', function() {
                var name = recorder.find('input#record-user').val();
                recorder.trigger('update', {username: name});
            });
        });
    </script>
</div>
